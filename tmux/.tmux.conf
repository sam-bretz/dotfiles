# ╔═══════════════════════════════════════════════════════════════════╗
# ║                    OPTIMIZED TMUX CONFIGURATION                     ║
# ║                  Enhanced for Developer Experience                   ║
# ╚═══════════════════════════════════════════════════════════════════╝

# ────────────────────────────── CORE SETTINGS ──────────────────────────────
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Prefix: Ctrl-F (optimized for comfort)
set -g prefix C-f
unbind C-b
bind-key C-f send-prefix

# ────────────────────────────── PERFORMANCE ────────────────────────────────
set -sg escape-time 0                    # Instant ESC in Neovim
set -g history-limit 50000                # Increased scrollback
set -g buffer-limit 20                   # Number of paste buffers
set -g display-time 1500                 # Message display time
set -g remain-on-exit off                # Don't keep dead panes
set -g repeat-time 300                   # Repeat time for key combos
setw -g aggressive-resize on             # Resize to smallest client
set -g status-interval 5                 # Status refresh rate

# ────────────────────────────── GENERAL OPTIONS ────────────────────────────
set -g base-index 1                      # Start windows at 1
setw -g pane-base-index 1                # Start panes at 1
set -g renumber-windows on               # Renumber windows on close
set -g set-titles on                     # Set terminal title
set -g set-titles-string "#I:#W"         # Terminal title format
set -g mouse on                          # Enable mouse support
setw -g mode-keys vi                     # Vi mode for copy
set -g status-keys emacs                 # Emacs keys in command prompt
setw -g xterm-keys on                    # Enable xterm keys

# ────────────────────────────── PANE MANAGEMENT ────────────────────────────
# Smart splits that open in current directory
unbind %
unbind '"'
bind d split-window -v -c "#{pane_current_path}"
bind s split-window -h -c "#{pane_current_path}"

# Better pane resizing (capitals for vim consistency)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Alternative arrow key resizing
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# Zoom toggle
bind -r m resize-pane -Z

# Pane swapping
bind > swap-pane -D
bind < swap-pane -U

# ────────────────────────────── WINDOW MANAGEMENT ──────────────────────────
# Quick window switching without prefix (Alt+h/l)
bind -n M-h previous-window
bind -n M-l next-window

# Window creation with current path
bind c new-window -c "#{pane_current_path}"

# Move windows left/right
bind -r C-h swap-window -t -1\; select-window -t -1
bind -r C-l swap-window -t +1\; select-window -t +1

# ────────────────────────────── SESSION MANAGEMENT ─────────────────────────
# Quick session switching
bind ( switch-client -p  # Previous session
bind ) switch-client -n  # Next session

# Session menu with fuzzy selection
bind S new-session \; command-prompt -p "New session name:" "rename-session '%%'"
bind P choose-tree -Zs  # Session/window picker

# ────────────────────────────── COPY MODE ENHANCEMENTS ─────────────────────
# Enter copy mode quickly
bind v copy-mode
bind [ copy-mode
bind Escape copy-mode

# Vi-style copy mode bindings
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi H send -X start-of-line
bind -T copy-mode-vi L send -X end-of-line

# Incremental search
bind -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""

# Mouse drag to copy
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# ────────────────────────────── DEVELOPER SHORTCUTS ────────────────────────
# Quick development windows
bind g new-window -n git -c "#{pane_current_path}" "lazygit 2>/dev/null || git status"
bind t new-window -n test -c "#{pane_current_path}"
bind e new-window -n editor -c "#{pane_current_path}" "$EDITOR"

# Synchronize panes (useful for multi-server commands)
bind y setw synchronize-panes \; display "Sync #{?pane_synchronized,on,off}"

# Quick layouts
bind -n M-1 select-layout main-horizontal
bind -n M-2 select-layout main-vertical
bind -n M-3 select-layout even-horizontal
bind -n M-4 select-layout even-vertical
bind -n M-5 select-layout tiled

# Toggle status bar
bind b set status

# ────────────────────────────── STATUS BAR CONFIGURATION ───────────────────
# Left-justified status bar as requested
set -g status-justify left
set -g status-position bottom
set -g status-left-length 50
set -g status-right-length 150

# Status bar styling
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'
set -g message-style 'fg=#1e1e2e bg=#f9e2af bold'
set -g message-command-style 'fg=#1e1e2e bg=#f9e2af bold'

# Pane borders
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Window status
setw -g window-status-style 'fg=#bac2de bg=#1e1e2e'
setw -g window-status-format ' #I #W '
setw -g window-status-current-style 'fg=#1e1e2e bg=#89b4fa bold'
setw -g window-status-current-format ' #I #W '
setw -g window-status-bell-style 'fg=#1e1e2e bg=#f38ba8 bold'

# Reload config
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ────────────────────────────── PLUGIN CONFIGURATION ───────────────────────
# TPM Plugin Manager
set -g @plugin 'tmux-plugins/tpm'

# Essential plugins
set -g @plugin 'tmux-plugins/tmux-sensible'      # Sensible defaults
set -g @plugin 'christoomey/vim-tmux-navigator'  # Seamless vim navigation
set -g @plugin 'tmux-plugins/tmux-resurrect'     # Session persistence
set -g @plugin 'tmux-plugins/tmux-continuum'     # Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-yank'          # Enhanced clipboard
set -g @plugin 'tmux-plugins/tmux-open'          # Open URLs/files
set -g @plugin 'tmux-plugins/tmux-pain-control'  # Better pane control

# Minimal status theme (configured for left justification)
set -g @plugin 'niksingh710/minimal-tmux-status'

# Plugin configurations
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-processes 'ssh psql mysql sqlite3 mongod redis-server "~yarn start" "~npm start"'
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '15'

# Minimal tmux status configuration
set -g @minimal-tmux-justify "left"
set -g @minimal-tmux-bg "#89b4fa"
set -g @minimal-tmux-fg "#1e1e2e"
set -g @minimal-tmux-indicator-str "  tmux  "
set -g @minimal-tmux-indicator true
set -g @minimal-tmux-status "bottom"

# Custom status with indicators
set -g @minimal-tmux-right "#S #{?client_prefix,🔥,} #{?window_zoomed_flag,🔍,} #W:#I"
set -g @minimal-tmux-left "%H:%M %b-%d"
set -g @minimal-tmux-window-status-format "#I:#W"

# Initialize TPM (keep at bottom)
run '~/.tmux/plugins/tpm/tpm'